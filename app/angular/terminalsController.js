/**
 * Created by USER on 5/11/2016.
 */

var ipc = require('electron').ipcRenderer;
var remote = require('electron').remote;

var app = angular.module('FeatherQ', []);
app.controller('terminalsController', function($scope, $http) {
    $scope.app_url = remote.getGlobal('urls').app_url;
    $scope.services = [];
    $scope.terminals = [];

    //to be changed
    $scope.user_id = remote.getGlobal('ids').user_id;
    $scope.business_id = remote.getGlobal('ids').business_id;


    $scope.getServices = function(){
        $http.get($scope.app_url + '/business/businessdetails/' + $scope.business_id).success(function(response){
            $scope.services = response.business.services;
            $scope.terminals = response.business.terminals;
        });
    };

    $scope.selectTerminal = function(service_id, terminal_id){
        remote.getGlobal('ids').service_id = service_id;
        remote.getGlobal('ids').terminal_id = terminal_id;

        //get Service Name
        for(var service_index in $scope.services){
            if($scope.services[service_index].service_id == service_id){
                remote.getGlobal('names').service_name = $scope.services[service_index].name;
            }
        }

        //get Terminal Name
        for(var terminal_index in $scope.terminals){
            if($scope.terminals[terminal_index].terminal_id == terminal_id){
                remote.getGlobal('names').terminal_name = $scope.terminals[terminal_index].name;
            }
        }

        ipc.send('terminal-chosen');
    };

    $scope.isAssignedUser = function(user_id, terminal_id){
        terminals = $scope.terminals
        assigned = false;
        for(terminal in terminals){
            if(terminals[terminal].terminal_id == terminal_id){
                for(user in terminals[terminal].users){
                    if(terminals[terminal].users[user].user_id == user_id){
                        assigned = true;
                    }
                }
            }
        }
        return assigned;
    }

    $scope.getServices();

});